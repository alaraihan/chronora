<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title><%= title || 'Chronora Admin' %></title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />
<link rel="stylesheet" href="https://unpkg.com/cropperjs@1.6.1/dist/cropper.min.css">
  <link rel="stylesheet" href="/css/admin/footer.css">
  <link rel="stylesheet" href="/css/admin/sidebar.css">
  
  <% if (typeof pageCss !== 'undefined' && pageCss) { %>
    <link rel="stylesheet" href="/css/admin/<%= pageCss %>.css" />
  <% } %>

  <style>
    :root { --header-height: 70px; }
    body { margin: 0; padding-top: var(--header-height); background: #f8fafc; color: #1f2937; font-family: 'Segoe UI', sans-serif; }
  </style>
</head>
<body>

  <%- include('../../partials/admin/header') %>
  <%- include('../../partials/admin/sidebar') %>

  <main id="main" class="p-4">
    <%- body %>
  </main>

  <%- include('../../partials/admin/footer') %>


  <div id="logoutModal" class="modal-fade" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7); z-index:9999; justify-content:center; align-items:center;">
    <div style="background:#fff; padding:32px; border-radius:16px; width:90%; max-width:420px; text-align:center; box-shadow:0 20px 40px rgba(0,0,0,0.3);">
      <h3 style="margin:0 0 16px; color:#1f2937; font-size:1.5rem;">Confirm Logout</h3>
      <p style="color:#666; margin-bottom:28px; line-height:1.5;">Are you sure you want to sign out?</p>
      <div style="display:flex; gap:12px; justify-content:center;">
        <button onclick="closeLogoutModal()" style="padding:10px 24px; background:#e5e7eb; color:#374151; border:none; border-radius:8px; cursor:pointer; font-weight:500;">Cancel</button>
        <button onclick="confirmLogout()" style="padding:10px 24px; background:#ef4444; color:white; border:none; border-radius:8px; cursor:pointer; font-weight:500;">Sign Out</button>
      </div>
    </div>
  </div>

<script src="https://unpkg.com/cropperjs@1.6.1/dist/cropper.min.js"></script>  <link rel="stylesheet" href="/css/admin/header.css">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <% if (locals.message) { %>
  <script>
    Toastify({
      text: "<%= message.text %>",
      backgroundColor: "<%= message.type === 'success' ? '#4ade80' : '#ef4444' %>",
      duration: 3000,
      gravity: "top",
      position: "right"
    }).showToast();
  </script>
  <% } %>

  <script>
    function showLogoutModal() {
      document.getElementById("logoutModal").style.display = "flex";
    }

    function closeLogoutModal() {
      document.getElementById("logoutModal").style.display = "none";
    }

    async function confirmLogout() {
      try {
        await axios.get("/admin/logout");
        Toastify({
          text: "Logged out successfully!",
          backgroundColor: "#4ade80",
          duration: 2000
        }).showToast();
        setTimeout(() => location.href = "/admin/login", 800);
      } catch (err) {
        Toastify({
          text: "Logout failed",
          backgroundColor: "#ef4444"
        }).showToast();
      }
    }

    document.getElementById("logoutModal").addEventListener("click", (e) => {
      if (e.target === e.currentTarget) closeLogoutModal();
    });
  </script>

  <script src="/js/main.js"></script>
  <% if (typeof pageJs !== 'undefined' && pageJs) { %>
    <script src="/js/admin/<%= pageJs %>.js"></script>
  <% } %>

</body>
</html>