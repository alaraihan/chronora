<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title><%= title || 'Chronora Admin' %></title>

  <!-- ===== CSS ===== -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />
  <link rel="stylesheet" href="https://unpkg.com/cropperjs@1.6.1/dist/cropper.min.css">

  <link rel="stylesheet" href="/css/admin/header.css">
  <link rel="stylesheet" href="/css/admin/sidebar.css">
  <link rel="stylesheet" href="/css/admin/footer.css">

  <% if (typeof pageCss !== 'undefined' && pageCss) { %>
  <link rel="stylesheet" href="/css/admin/<%= pageCss %>.css">
<% } %>


  <style>
    :root { --header-height: 70px; }
    body {
      margin: 0;
      padding-top: var(--header-height);
      background: #f8fafc;
      color: #1f2937;
      font-family: 'Segoe UI', sans-serif;
    }
.custom-modal {
  display: none;
  position: fixed;
  z-index: 9999;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(5px);
  align-items: center;
  justify-content: center;
}

.custom-modal.active {
  display: flex;
}

.custom-modal-box {
  background: white;
  border-radius: 16px;
  width: 90%;
  max-width: 420px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
  overflow: hidden;
  animation: modalFadeIn 0.3s ease;
}

@keyframes modalFadeIn {
  from { opacity: 0; transform: scale(0.95); }
  to { opacity: 1; transform: scale(1); }
}

.custom-modal-header {
  background: #4f46e5;
  color: white;
  padding: 20px 28px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 18px;
  font-weight: 600;
}

.custom-close {
  font-size: 32px;
  cursor: pointer;
  font-weight: 300;
  opacity: 0.9;
}

.custom-close:hover {
  opacity: 1;
}

.custom-modal-body {
  padding: 32px;
  text-align: center;
}

.custom-modal-body p {
  font-size: 16px;
  color: #374151;
  margin-bottom: 28px;
}

.custom-modal-actions {
  display: flex;
  gap: 12px;
  justify-content: center;
}

.btn-cancel {
  padding: 12px 28px;
  background: #f1f5f9;
  color: #475569;
  border: none;
  border-radius: 10px;
  font-size: 15px;
  font-weight: 500;
  cursor: pointer;
  min-width: 120px;
}

.btn-cancel:hover {
  background: #e2e8f0;
}

.btn-signout {
  padding: 12px 28px;
  background: #ef4444;
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 15px;
  font-weight: 500;
  cursor: pointer;
  min-width: 120px;
}

.btn-signout:hover {
  background: #dc2626;
}
  </style>
</head>

<body>

  <%- include('../../partials/admin/header') %>
  <%- include('../../partials/admin/sidebar') %>

  <main id="main" class="p-4">
    <%- body %>
  </main>

  <%- include('../../partials/admin/footer') %>

<div id="customLogoutModal" class="custom-modal">
  <div class="custom-modal-box">
    <div class="custom-modal-header">
      <h3>Confirm Logout</h3>
      <span class="custom-close" onclick="hideLogoutModal()">Ã—</span>
    </div>
    <div class="custom-modal-body">
      <p>Are you sure you want to sign out?</p>
      <div class="custom-modal-actions">
        <button class="btn-cancel" onclick="hideLogoutModal()">Cancel</button>
        <button class="btn-signout" onclick="confirmLogout()">Sign Out</button>
      </div>
    </div>
  </div>
</div>
<script>
  window.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".modal-backdrop").forEach(b => b.remove());
    document.body.classList.remove("modal-open");
    document.body.style.overflow = "auto";
  });
</script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  <script src="https://unpkg.com/cropperjs@1.6.1/dist/cropper.min.js"></script>

  <% if (locals.message) { %>
    <script>
      Toastify({
        text: "<%= message.text %>",
        backgroundColor: "<%= message.type === 'success' ? '#4ade80' : '#ef4444' %>",
        duration: 3000,
        gravity: "bottom",
        position: "right"
      }).showToast();
    </script>
  <% } %>

  <script>
  function showLogoutModal() {
    document.getElementById('customLogoutModal').classList.add('active');
  }

  function hideLogoutModal() {
    document.getElementById('customLogoutModal').classList.remove('active');
  }

  async function confirmLogout() {
    try {
      await axios.get("/admin/logout");
      Toastify({
        text: "Logged out successfully!",
        backgroundColor: "#4ade80",
        duration: 2000
      }).showToast();

      setTimeout(() => {
        window.location.href = "/admin/login";
      }, 800);
    } catch (err) {
      Toastify({
        text: "Logout failed",
        backgroundColor: "#ef4444"
      }).showToast();
    }
  }
</script>
  <script src="/js/main.js"></script>

 <% if (typeof pageJs !== 'undefined' && pageJs) { %>
  <script src="/js/admin/<%= pageJs %>.js"></script>
<% } %>


</body>
</html>
