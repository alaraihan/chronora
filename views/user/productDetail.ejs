<div class="breadcrumbs">
  <a href="/">Home</a> <span>›</span>
  <a href="/watch">Watches</a> <span>›</span>
  <span><%= product.name %></span>
</div>

<div class="product-wrapper" style="display:flex; gap:2rem; align-items:flex-start;">

  <div class="gallery" style="flex:1; max-width:540px; position:relative;">
    <div class="main-img" style="box-shadow:0 6px 18px rgba(0,0,0,0.06); padding:1rem; background:#fff; border-radius:8px;">
      <% 
        const activeImages = (variant && variant.images && variant.images.length)
          ? variant.images 
          : ['/images/placeholder-watch.jpg'];
      %>

      <div class="zoom-container" style="width:100%; overflow:hidden; border-radius:6px;">
        <img id="mainImage" src="<%= activeImages[0] %>" alt="<%= product.name %>" style="width:100%; height:auto; object-fit:contain; display:block;">
      </div>
    </div>

    <% if (activeImages.length > 1) { %>
      <div class="thumbnails" style="display:flex; gap:0.5rem; margin-top:12px;">
        <% activeImages.forEach((img, i) => { %>
          <img 
            src="<%= img %>" 
            class="<%= i === 0 ? 'active' : '' %>"
            onclick="document.getElementById('mainImage').src=this.src; document.querySelectorAll('.thumbnails img').forEach(function(t){ t.classList.remove('active'); }); this.classList.add('active');"
            style="width:64px; height:64px; object-fit:cover; border-radius:6px; cursor:pointer; border:2px solid transparent;"
            alt="thumbnail"
          >
        <% }) %>
      </div>
    <% } %>
  </div>

  <div class="details" style="flex:1;">
    <h1 style="margin-top:0;"><%= product.name %></h1>

<div class="price-section" style="margin:16px 0;">
  <% if (product.offerData) { %>
    <del class="original-price" style="font-size:18px; color:#999;">
      ₹ <%= Number(product.price).toLocaleString('en-IN') %>
    </del>
    <div class="discounted-price" style="font-size:32px; font-weight:bold; color:#2ecc71; margin:8px 0;">
      ₹ <%= product.offerData.offerPrice.toLocaleString('en-IN') %>
    </div>
    <div class="savings" style="font-size:18px; color:#e74c3c; font-weight:600;">
      You Save ₹ <%= product.offerData.discountAmount.toLocaleString('en-IN') %>
    </div>
    <span class="offer-badge-large" style="
      display:inline-block; 
      background:linear-gradient(135deg, #ff3b30, #ff9500); 
      color:white; 
      padding:8px 16px; 
      border-radius:30px; 
      font-size:14px; 
      font-weight:bold; 
      margin-top:12px;
      animation: pulse-badge 2.5s ease-in-out infinite;
    ">
      <% if (product.offerData.offer.discountType === 'percentage') { %>
        <%= product.offerData.offer.discountValue %>% OFF
      <% } else { %>
        ₹<%= product.offerData.offer.discountValue %> OFF
      <% } %>
    </span>
  <% } else { %>
    <div class="regular-price" style="font-size:32px; font-weight:bold; color:#667eea;">
      ₹ <%= Number(product.price).toLocaleString('en-IN') %>
    </div>
  <% } %>
</div>

<div class="status <%= stockStatus === 'In Stock' ? 'in-stock' : 'out-stock' %>" style="margin:12px 0; font-size:16px;">
  <%= stockStatus %>
</div>

<% if (variant && variant.colorName) { %>
  <div class="variant-info" style="margin:12px 0; font-size:16px;">Color: <strong><%= variant.colorName %></strong></div>
<% } %>

<% if (product.offerData) { %>
  <span class="offer-badge-large image-badge" style="
    position:absolute; 
    top:16px; 
    right:16px; 
    background:linear-gradient(135deg, #ff3b30, #ff9500); 
    color:white; 
    padding:10px 20px; 
    border-radius:30px; 
    font-size:16px; 
    font-weight:bold; 
    z-index:10;
    box-shadow:0 4px 15px rgba(255,59,48,0.4);
    animation: pulse-badge 2.5s ease-in-out infinite;
  ">
    <% if (product.offerData.offer.discountType === 'percentage') { %>
      <%= product.offerData.offer.discountValue %>% OFF
    <% } else { %>
      ₹<%= product.offerData.offer.discountValue %> OFF
    <% } %>
  </span>
<% } %>

<p class="description" style="line-height:1.7; color:#555; margin:20px 0; font-size:16px;">
  <%= product.description || "A timeless piece of elegance." %>
</p>

    

  
    <% if (variants && variants.length > 0) { %>
      <div class="variant-buttons" style="margin:12px 0;">
        <% variants.forEach(function(v) { 
             const isActive = variant && v._id && variant._id && v._id.toString() === variant._id.toString();
             const label = v.colorName || v.name || (v.reference ? v.reference : ('Variant ' + (v._id.toString().slice(-4))));
        %>
          <a 
            href="/product/<%= product._id %>?variant=<%= v._id %>" 
            class="variant-btn <%= isActive ? 'active' : '' %>" 
            data-variant-id="<%= v._id %>" 
            role="button"
            aria-pressed="<%= isActive ? 'true' : 'false' %>"
            title="<%= label %>"
          >
            <span class="variant-label"><%= label %></span>
            <% if (isActive) { %>
              <span class="variant-check" aria-hidden="true">✓</span>
            <% } %>
          </a>
        <% }); %>
      </div>
    <% } %>

    <!-- Quantity controls -->
    <div id="quantityWrapper" style="margin: 12px 0;">
      <div class="quantity-box" id="quantityBox" data-initial="1" data-max-stock="<%= (variant && variant.stock) ? variant.stock : 1 %>" aria-label="Quantity selector">
        <button type="button" class="qty-btn" id="qtyMinus" aria-label="Decrease quantity">−</button>
        <span id="qtyValue" aria-live="polite">1</span>
        <button type="button" class="qty-btn" id="qtyPlus" aria-label="Increase quantity">+</button>
      </div>
    </div>

    <!-- Add to cart button: use consistent class "add-to-cart" -->
    <button 
      type="button"
      class="add-to-cart"
      data-product-id="<%= product._id %>" 
      data-variant-id="<%= (variant && variant._id) ? variant._id : '' %>"
      <%= stockStatus !== 'In Stock' ? 'disabled' : '' %>
      style="padding:12px 32px; font-size:16px; background:#007bff; color:white; border:none; border-radius:8px; cursor:pointer; margin-top:12px;">
      <%= stockStatus === 'In Stock' ? 'Add to Cart' : 'Out of Stock' %>
    </button>

    <% if (product.highlights && product.highlights.length > 0) { %>
      <div class="highlights" style="margin-top:16px;">
        <h3>Key Highlights</h3>
        <ul>
          <% product.highlights.forEach(function(h) { %>
            <li><%= h %></li>
          <% }); %>
        </ul>
      </div>
    <% } %>
  </div>
</div>

<!-- Related Products (unchanged) -->
<% if (relatedProducts && relatedProducts.length > 0) { %>
  <section class="related-section" style="margin-top:32px;">
    <h2>You May Also Like</h2>
    <div class="related-grid" style="display:flex; gap:24px; flex-wrap:wrap; margin-top:16px;">
      <% relatedProducts.forEach(function(r) { %>
        <%  
          var relImg = '/images/placeholder-watch.jpg';
          if (typeof allVariants !== 'undefined' && Array.isArray(allVariants) && allVariants.length) {
            var relVariant = allVariants.find(function(v){ return String(v.product) === String(r._id); });
            if (relVariant && relVariant.images && relVariant.images.length) {
              relImg = relVariant.images[0];
            }
          }
        %>
        <a href="/product/<%= r._id %>" class="related-card" style="width:180px; text-align:center; text-decoration:none; color:inherit;">
          <div style="width:100%; height:140px; display:flex; align-items:center; justify-content:center; background:#fff; box-shadow:0 6px 18px rgba(0,0,0,0.06); border-radius:8px; overflow:hidden;">
            <img src="<%= relImg %>" alt="<%= r.name %>" style="max-width:100%; max-height:100%; object-fit:contain;">
          </div>
          <div class="info" style="margin-top:8px;">
            <h4 style="font-size:14px; margin:6px 0;"><%= r.name %></h4>
            <p class="price" style="color:#c0392b; font-weight:600;">₹ <%= Number(r.price).toLocaleString('en-IN') %></p>
          </div>
        </a>
      <% }); %>
    </div>
  </section>
<% } %>


