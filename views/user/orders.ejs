<link rel="stylesheet" href="/css/user/orders.css">

<div class="orders-container">
  <aside class="sidebar">
    <%- include('../partials/user/sidebar') %>
  </aside>

  <main class="orders-content">
    <h1>My Orders</h1>
    <p class="subtext">Manage your order history here.</p>

    <div class="orders-list" id="ordersList">
      <% if (!orders || orders.length === 0) { %>
        <p style="text-align:center; color:#999; padding:60px;">No orders yet.</p>
      <% } else { %>
        <% orders.forEach(order => { %>
          <% order.products.forEach(item => { %>
            <!-- Each product gets its own card -->
            <div class="order-card">
              <div class="order-header-inline">
                <div class="order-meta">
                  <span class="order-date"><%= new Date(order.createdAt).toDateString() %></span>
                  <span class="order-id-small">Order #<%= order.orderId %></span>
                </div>
                <div class="item-status-badge">
                  <span class="status-label <%= item.itemStatus.toLowerCase().replace(/\s+/g, '-') %>">
                    <%= item.itemStatus %>
                  </span>
                </div>
              </div>

              <div class="order-item-main">
                <div class="item-image-wrapper">
                  <img 
                    src="<%= item.variantId?.images?.[0] || '/images/default-watch.jpg' %>" 
                    alt="<%= item.productId?.name || 'Watch' %>"
                    class="item-image"
                    onerror="this.src='/images/default-watch.jpg'"
                  >
                </div>

                <div class="item-details">
                  <h3 class="item-name"><%= item.productId?.name || 'Unknown Watch' %></h3>
                  <p class="item-variant"><%= item.variantId?.colorName || 'Standard' %></p>
                  <p class="item-quantity">Qty: <%= item.quantity %></p>
                  <p class="item-price">â‚¹<%= (item.price * item.quantity).toLocaleString('en-IN') %></p>
                  
                  <% if (item.reason) { %>
                    <p class="item-reason"><strong>Reason:</strong> <%= item.reason %></p>
                  <% } %>
                </div>

                <div class="item-actions">
                  <!-- ONLY View Details Button -->
                  <a href="/profile/orders/<%= order.orderId %>?productId=<%= item.productId._id %>&variantId=<%= item.variantId._id %>" 
                     class="btn btn-view">
                    View Details
                  </a>
                </div>
              </div>

              <!-- Optional: Expected Delivery -->
              <% if (order.expectedDelivery && !['Delivered', 'Cancelled', 'ReturnRequested', 'Returned'].includes(item.itemStatus)) { %>
                <div class="delivery-info">
                  <span>Expected Delivery: <%= new Date(order.expectedDelivery).toDateString() %></span>
                </div>
              <% } %>
            </div>
          <% }) %>
        <% }) %>
      <% } %>
    </div>
  </main>
</div>

<!-- No script needed here anymore unless you have other JS -->