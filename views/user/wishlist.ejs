<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Wishlist | Chronora</title>
  <link rel="stylesheet" href="/css/user/profile-shared.css">
  <link rel="stylesheet" href="/css/user/wishlist.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
</head>

<body>
  <%- include('../partials/user/header') %>

    <div class="profile-layout">
      <%- include('../partials/user/sidebar') %>

        <main class="profile-content">
          <header class="page-title-header">
            <h1 class="page-title">My Wishlist</h1>
            <p class="subtitle">Your saved items for later.</p>
          </header>

          <div class="wishlist-content-wrapper" style="width: 100%;">
            <% if (wishlist?.length) { %>
              <div class="wishlist-grid">
                <% wishlist.forEach(item=> {
                  if (!item?.productId) return; // Skip invalid items
                  %>

                  <div class="wishlist-card" data-product-id="<%= item.productId?._id || '' %>"
                    style="cursor: pointer;">
                    <div class="image-wrapper">
                      <img src="<%= item.variantId?.images?.[0] || '/images/default-watch.jpg' %>"
                        alt="<%= item.productId?.name || 'Product' %>" class="product-img" loading="lazy">
                    </div>

                    <div class="card-content">
                      <h3 class="product-name">
                        <%= item.productId?.name || 'Unknown Product' %>
                      </h3>

                      <p class="variant-info">
                        <%= item.variantId?.colorName || 'Standard' %>
                      </p>

                      <div class="price-container">
                        <% if (item.productId?.offerData) { %>
                          <p class="original-price">
                            ₹ <%= item.productId.price?.toLocaleString?.('en-IN') || 'N/A' %>
                          </p>

                          <p class="offer-price">
                            ₹ <%= item.productId.offerData.offerPrice?.toLocaleString?.('en-IN') || 'N/A' %>
                          </p>

                          <span class="save-badge">
                            <% if (item.productId.offerData.offer?.discountType==='percentage' ) { %>
                              <%= item.productId.offerData.offer.discountValue %>% OFF
                                <% } else { %>
                                  ₹<%= item.productId.offerData.offer?.discountValue || 0 %> OFF
                                    <% } %>
                          </span>

                          <% } else { %>
                            <p class="price">
                              ₹ <%= item.productId?.price?.toLocaleString?.('en-IN') || 'N/A' %>
                            </p>
                            <% } %>
                      </div>

                      <div class="actions">
                        <button class="btn-move-cart" data-product-id="<%= item.productId?._id || '' %>"
                          data-variant-id="<%= item.variantId?._id || '' %>">
                          Move to Cart
                        </button>

                        <button class="btn-remove" data-product-id="<%= item.productId?._id || '' %>"
                          data-variant-id="<%= item.variantId?._id || '' %>">
                          Remove
                        </button>
                      </div>
                    </div>
                  </div>

                  <% }) %>
              </div>

              <% } else { %>
                <div class="empty-wishlist">
                  <p>Your wishlist is empty.</p>
                  <a href="/watch" class="btn-primary">Add Products</a>
                </div>
                <% } %>
          </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="/js/user/wishlist.js"></script>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const wishlistCards = document.querySelectorAll('.wishlist-card');

        wishlistCards.forEach(card => {
          card.addEventListener('click', (e) => {
            if (e.target.closest('.btn-move-cart') ||
              e.target.closest('.btn-remove')) {
              return;
            }

            const productId = card.dataset.productId;
            if (productId) {
              window.location.href = `/product/${productId}`;
            }
          });
        });
      });
    </script>

</body>

</html>