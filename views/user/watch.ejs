<link rel="stylesheet" href="/css/user/watch.css">
   
   <main>
        <h1>The Watch Collection</h1>

        
         <div class="filters-container">
  <!-- Left: Search Bar -->
  <form class="search-form" method="GET">
    <div class="search-input-group">
      <input 
        type="text" 
        name="search" 
        placeholder="Search by name" 
        value="<%= searchQuery || '' %>"
        autocomplete="off"
      >
<button type="submit">Search</button>

<a href="/watch" class="clear-btn">Clear</a>
    </div>
  </form>

  <!-- Right: Sort & Category -->
  <div class="controls-right">
    <!-- Sort -->
    <form method="GET" class="control-form">
      <select name="sort" onchange="this.form.submit()">
        <option value="newest"    <%= sortQuery === 'newest' ? 'selected' : '' %>>Newest</option>
        <option value="price-low" <%= sortQuery === 'price-low' ? 'selected' : '' %>>Price: Low to High</option>
        <option value="price-high"<%= sortQuery === 'price-high' ? 'selected' : '' %>>Price: High to Low</option>
        <option value="a-z"       <%= sortQuery === 'a-z' ? 'selected' : '' %>>A to Z</option>
        <option value="z-a"       <%= sortQuery === 'z-a' ? 'selected' : '' %>>Z to A</option>
      </select>
      <% if (searchQuery) { %><input type="hidden" name="search" value="<%= searchQuery %>"><% } %>
      <% if (categoryFilter) { %><input type="hidden" name="category" value="<%= categoryFilter %>"><% } %>
    </form>

    <!-- Category -->
    <form method="GET" class="control-form">
      <select name="category" onchange="this.form.submit()">
        <option value="">All Categories</option>
        <% categories.forEach(cat => { %>
          <option value="<%= cat._id %>" <%= categoryFilter === cat._id.toString() ? 'selected' : '' %>>
            <%= cat.name %>
          </option>
        <% }) %>
      </select>
      <% if (searchQuery) { %><input type="hidden" name="search" value="<%= searchQuery %>"><% } %>
      <% if (sortQuery) { %><input type="hidden" name="sort" value="<%= sortQuery %>"><% } %>
    </form>
  </div>
</div>
        <div class="watch-grid">
    <% if (products && products.length > 0) { %>
        <% products.forEach((product, index) => { %>

            <% 
                const variant = product.variant;
                const image = variant?.images?.[0] || '/images/placeholder-watch.jpg';
                const stock = variant ? variant.stock : 0;
            %>

            <!-- CLICKABLE CARD (WRAPPED IN <a>) -->
            <a href="/product/<%= product._id %>" class="watch-card" style="text-decoration:none; color:inherit;">

                <div class="watch-image" style="background-color: <%= index % 2 === 0 ? '#f8f8f8' : '#ffffff' %>;">
                    <img src="<%= image %>" 
                        alt="<%= product.name %>"
                        loading="lazy">

                    <button class="favorite-btn">♡</button>
                </div>

                <div class="watch-info">
                    <div class="watch-name"><%= product.name %></div>

                    <p class="watch-price">₹ <%= product.price %></p>

                    <% if (variant && variant.colorName) { %>
                        <div style="color:#888; font-size:13px;">Color: <%= variant.colorName %></div>
                    <% } %>

                    <button class="add-to-cart-btn"
                            data-product-id="<%= product._id %>"
                            data-variant-id="<%= variant ? variant._id : '' %>"
                            <%= stock <= 0 ? 'disabled' : '' %>>
                        <%= stock <= 0 ? 'Out of Stock' : 'Add to Cart' %>
                    </button>
                </div>

            </a>
        <% }) %>
    <% } else { %>
        <div class="empty-state">
            <h2>No watches available</h2>
            <p>Check back later</p>
        </div>
    <% } %>
    <!-- PAGINATION -->
<% if (totalPages > 1) { %>
  <div class="pagination">

    <!-- Prev Button -->
    <% if (currentPage > 1) { %>
      <a 
        href="?page=<%= currentPage - 1 %>&search=<%= searchQuery %>&sort=<%= sortQuery %>&category=<%= categoryFilter %>" 
        class="page-btn"
      >
        Prev
      </a>
    <% } else { %>
      <span class="page-btn disabled">Prev</span>
    <% } %>

    <!-- Page Numbers -->
    <% for (let i = 1; i <= totalPages; i++) { %>
      <% if (i === currentPage) { %>
        <span class="page-number active"><%= i %></span>
      <% } else { %>
        <a 
          href="?page=<%= i %>&search=<%= searchQuery %>&sort=<%= sortQuery %>&category=<%= categoryFilter %>" 
          class="page-number"
        >
          <%= i %>
        </a>
      <% } %>
    <% } %>

    <!-- Next Button -->
    <% if (currentPage < totalPages) { %>
      <a 
        href="?page=<%= currentPage + 1 %>&search=<%= searchQuery %>&sort=<%= sortQuery %>&category=<%= categoryFilter %>" 
        class="page-btn"
      >
        Next
      </a>
    <% } else { %>
      <span class="page-btn disabled">Next</span>
    <% } %>

  </div>
<% } %>

</div>


    </main>
    <script src="/js/user/watch.js"></script>
